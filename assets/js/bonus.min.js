const user="ineditDuMois",repo="bonus",branch="main",downloadLinks=document.querySelectorAll(".bonusDownloadLink"),linksNb=downloadLinks.length,maxRetryNb=2;let assets={},token=null;function onSubmit(e){return token=e.querySelector("#bonusCredentialsToken").value,initAssets(),!1}function initAssets(){const e=new Request(`https://api.github.com/repos/${user}/${repo}/contents/assets?ref=${branch}`,{method:"GET",headers:{Accept:"application/json",Authorization:`token ${token}`}});fetch(e).then((e=>{200!==e.status?alert("Le mot de passe que vous avez renseigné est incorrect."):e.json().then((e=>{for(let t=0;t<linksNb;t++){downloadLinks[t].classList.remove("bonusDownloadLink");for(let s=0;s<e.length;s++)downloadLinks[t].id+".pdf"===e[s].name&&(assets[downloadLinks[t].id]={url:e[s].url,filename:e[s].name})}}))}))}function downloadFile(e,t){const s=assets[e.id]?assets[e.id].url:null;if(null===s)return alert("Une erreur imprévue s'est produite lors du téléchargement, j'en suis désolée. N'hésitez pas à me contacter par email, je vous transmettrai en retour le fichier qui pose problème."),!1;const n=new Request(s,{method:"GET",headers:{Accept:"application/vnd.github.v3.raw",Authorization:`token ${token}`}});return fetch(n).then((s=>{200!==s.status?null===token?alert("Votre session semble avoir expiré, veuillez saisir à nouveau le mot de passe."):t<2?(t++,initAssets(),downloadFile(e,t)):alert("Une erreur imprévue s'est produite lors du téléchargement, j'en suis désolée. N'hésitez pas à me contacter par email, je vous transmettrai en retour le fichier qui pose problème."):s.blob().then((t=>{const s=window.URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=s,n.download=assets[e.id].filename,n.click()}))})).catch((function(e){alert("Une erreur s'est produite lors du téléchargement. Je vous suggère d'utiliser le navigateur Chrome. Si le problème persiste, n'hésitez pas à me contacter par email.")})),!1}
